<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ°Ô∏è Voice Scam Shield - Advanced Live Monitor</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõ°Ô∏è</text></svg>">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .control-panel {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .monitor-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .transcript-box, .analysis-box {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            min-height: 300px;
        }
        .alert-box {
            background: rgba(255,0,0,0.2);
            border: 2px solid #ff4444;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            display: none;
        }
        .alert-critical {
            background: rgba(255,0,0,0.4);
            animation: flashRed 1s infinite;
        }
        .alert-high {
            background: rgba(255,140,0,0.3);
            border-color: #ff8c00;
        }
        @keyframes flashRed {
            0%, 50% { opacity: 1; }
            25%, 75% { opacity: 0.5; }
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .start-btn {
            background: #4CAF50;
            color: white;
        }
        .stop-btn {
            background: #f44336;
            color: white;
        }
        .test-btn {
            background: #2196F3;
            color: white;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            margin-left: 10px;
        }
        .status-connected {
            background: #4CAF50;
        }
        .status-disconnected {
            background: #f44336;
        }
        .risk-meter {
            background: rgba(255,255,255,0.1);
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }
        .risk-fill {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 15px;
        }
        .risk-low { background: #4CAF50; }
        .risk-medium { background: #FF9800; }
        .risk-high { background: #F44336; }
        .risk-critical { background: #8B0000; }
        .log {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .test-scenarios {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ°Ô∏è Voice Scam Shield - Live Fraud Monitor</h1>
            <p>Real-time transcription with immediate fraud detection and warnings</p>
        </div>

        <div class="control-panel">
            <h3>üéõÔ∏è Control Panel</h3>
            <button id="startBtn" class="start-btn">üé§ Start Monitoring</button>
            <button id="stopBtn" class="stop-btn" disabled>‚èπÔ∏è Stop Monitoring</button>
            <span id="status" class="status status-disconnected">Disconnected</span>
            
            <div style="margin-top: 15px;">
                <strong>Risk Level:</strong>
                <div class="risk-meter">
                    <div id="riskFill" class="risk-fill risk-low" style="width: 0%"></div>
                </div>
                <span id="riskLabel">LOW (0%)</span>
            </div>
        </div>

        <div class="alert-box" id="alertBox">
            <h4 id="alertTitle">‚ö†Ô∏è FRAUD ALERT</h4>
            <p id="alertMessage"></p>
            <p><strong>Indicators:</strong> <span id="alertIndicators"></span></p>
            <p><strong>Recommendation:</strong> <span id="alertRecommendation"></span></p>
        </div>

        <div class="monitor-display">
            <div class="transcript-box">
                <h3>üìù Live Transcript</h3>
                <div id="transcript" style="height: 250px; overflow-y: auto; border: 1px solid rgba(255,255,255,0.3); padding: 10px; background: rgba(0,0,0,0.2);">
                    <em>Transcript will appear here...</em>
                </div>
            </div>
            
            <div class="analysis-box">
                <h3>üîç Analysis</h3>
                <div id="analysis" style="height: 250px; overflow-y: auto; border: 1px solid rgba(255,255,255,0.3); padding: 10px; background: rgba(0,0,0,0.2);">
                    <em>Analysis results will appear here...</em>
                </div>
            </div>
        </div>

        <div class="test-scenarios">
            <h3>üß™ Test Scenarios</h3>
            <p>Click these buttons to simulate different types of calls:</p>
            <button class="test-btn" onclick="simulateScenario('scam')">üö® Simulate Scam Call</button>
            <button class="test-btn" onclick="simulateScenario('suspicious')">‚ö†Ô∏è Simulate Suspicious Call</button>
            <button class="test-btn" onclick="simulateScenario('legitimate')">‚úÖ Simulate Legitimate Call</button>
        </div>

        <div class="log" id="log">
            <strong>System Log:</strong><br>
            Ready to start monitoring...<br>
        </div>
    </div>

    <script>
        let ws = null;
        let sessionId = null;
        let isMonitoring = false;

        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const status = document.getElementById('status');
        const transcript = document.getElementById('transcript');
        const analysis = document.getElementById('analysis');
        const alertBox = document.getElementById('alertBox');
        const log = document.getElementById('log');
        const riskFill = document.getElementById('riskFill');
        const riskLabel = document.getElementById('riskLabel');

        function addLog(message) {
            log.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
            log.scrollTop = log.scrollHeight;
        }

        function updateRiskMeter(riskScore, riskLevel) {
            const percentage = Math.round(riskScore * 100);
            riskFill.style.width = percentage + '%';
            riskLabel.textContent = `${riskLevel} (${percentage}%)`;
            
            // Update color based on risk level
            riskFill.className = 'risk-fill risk-' + riskLevel.toLowerCase();
        }

        function showAlert(alert) {
            alertBox.style.display = 'block';
            alertBox.className = 'alert-box alert-' + alert.severity.toLowerCase();
            
            document.getElementById('alertTitle').textContent = `${alert.severity} RISK DETECTED`;
            document.getElementById('alertMessage').textContent = alert.message;
            document.getElementById('alertIndicators').textContent = alert.indicators.join(', ');
            document.getElementById('alertRecommendation').textContent = alert.recommended_action;
            
            // Play alert sound based on severity
            if (alert.severity === 'CRITICAL') {
                playAlertSound('urgent');
            } else if (alert.severity === 'HIGH') {
                playAlertSound('warning');
            }
            
            addLog(`üö® ${alert.severity} ALERT: ${alert.message}`);
        }

        function playAlertSound(type) {
            // Create audio context for alert sounds
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            if (type === 'urgent') {
                // Play urgent beeping
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.value = 800;
                        gainNode.gain.value = 0.3;
                        
                        oscillator.start();
                        oscillator.stop(audioContext.currentTime + 0.2);
                    }, i * 300);
                }
            } else if (type === 'warning') {
                // Play warning tone
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 600;
                gainNode.gain.value = 0.2;
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
            }
        }

        function startMonitoring() {
            ws = new WebSocket('ws://localhost:8000/ws/live-fraud-monitor');
            
            ws.onopen = function() {
                status.textContent = 'Connected';
                status.className = 'status status-connected';
                startBtn.disabled = true;
                stopBtn.disabled = false;
                isMonitoring = true;
                addLog('‚úÖ Connected to fraud monitoring service');
                
                // Start transcription
                ws.send(JSON.stringify({
                    type: 'start_transcription'
                }));
            };
            
            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                
                switch(data.type) {
                    case 'session_started':
                        sessionId = data.session_id;
                        addLog(`üé§ Monitoring session started: ${sessionId}`);
                        break;
                        
                    case 'transcription_started':
                        addLog('üé§ Live transcription and fraud monitoring active');
                        break;
                        
                    case 'live_transcription':
                        transcript.innerHTML = data.accumulated_transcript || 'Listening...';
                        transcript.scrollTop = transcript.scrollHeight;
                        break;
                        
                    case 'context_analysis':
                        updateRiskMeter(data.risk_score, data.risk_level);
                        analysis.innerHTML = `
                            <strong>Risk Level:</strong> ${data.risk_level}<br>
                            <strong>Risk Score:</strong> ${(data.risk_score * 100).toFixed(1)}%<br>
                            <strong>Confidence:</strong> ${(data.confidence * 100).toFixed(1)}%<br>
                            <strong>Classification:</strong> ${data.label}<br>
                            <strong>Key Indicators:</strong><br>
                            ${data.key_indicators.map(indicator => `‚Ä¢ ${indicator}`).join('<br>')}
                            <br><br>
                            <strong>Recommendation:</strong><br>
                            ${data.recommendation}
                        `;
                        break;
                        
                    case 'fraud_alert':
                        showAlert(data.alert);
                        break;
                        
                    case 'session_ended':
                        addLog('üìä Monitoring session completed');
                        analysis.innerHTML += `<br><br><strong>Final Report:</strong><br>
                            Duration: ${data.final_report.duration}<br>
                            Total Alerts: ${data.final_report.total_alerts}<br>
                            Final Risk: ${data.final_report.final_risk_level}
                        `;
                        break;
                        
                    case 'error':
                        addLog(`‚ùå Error: ${data.message}`);
                        break;
                }
            };
            
            ws.onclose = function() {
                status.textContent = 'Disconnected';
                status.className = 'status status-disconnected';
                startBtn.disabled = false;
                stopBtn.disabled = true;
                isMonitoring = false;
                addLog('üîå Disconnected from fraud monitoring service');
            };
            
            ws.onerror = function(error) {
                addLog(`‚ùå WebSocket error: ${error}`);
            };
        }

        function stopMonitoring() {
            if (ws && isMonitoring) {
                ws.send(JSON.stringify({
                    type: 'stop'
                }));
                
                setTimeout(() => {
                    ws.close();
                }, 1000);
            }
        }

        function simulateScenario(type) {
            if (!ws || !isMonitoring) {
                alert('Please start monitoring first!');
                return;
            }
            
            let simulatedText = '';
            
            switch(type) {
                case 'scam':
                    simulatedText = "Hello, this is from your bank security department. We've detected suspicious activity on your account and need you to verify your social security number immediately. Your account will be suspended if you don't act now. Please provide your credit card details to confirm your identity.";
                    break;
                case 'suspicious':
                    simulatedText = "Congratulations! You've won a prize worth $10,000. To claim your winnings, we need you to pay a small processing fee of $200 via wire transfer. This is a limited time offer that expires today.";
                    break;
                case 'legitimate':
                    simulatedText = "Hello, this is Sarah calling from ABC Insurance regarding your recent inquiry about life insurance policies. I'd like to schedule a time to discuss the different coverage options available to you. Would tomorrow afternoon work for you?";
                    break;
            }
            
            // Simulate the text being "transcribed" word by word
            const words = simulatedText.split(' ');
            let currentText = '';
            
            words.forEach((word, index) => {
                setTimeout(() => {
                    currentText += word + ' ';
                    
                    // Send as if it were a real transcription segment
                    ws.send(JSON.stringify({
                        type: 'simulated_transcript',
                        segment: {
                            text: currentText.trim(),
                            confidence: 0.9,
                            timestamp: new Date().toISOString()
                        }
                    }));
                }, index * 200); // 200ms delay between words
            });
            
            addLog(`üß™ Simulating ${type} call scenario`);
        }

        // Event listeners
        startBtn.addEventListener('click', startMonitoring);
        stopBtn.addEventListener('click', stopMonitoring);

        // Auto-hide alert after 10 seconds
        setInterval(() => {
            if (alertBox.style.display === 'block') {
                setTimeout(() => {
                    alertBox.style.display = 'none';
                }, 10000);
            }
        }, 1000);
    </script>
</body>
</html>
